(function(){function r(a){return(10>a?"0":"")+a}function F(a){var b=++G+"";return a?a+b:b}function d(a,b){function e(a,c){var e=u.offset(),f=/^touch/.test(a.type),k=e.left+100,h=e.top+100,g=(f?a.originalEvent.touches[0]:a).pageX-k,d=(f?a.originalEvent.touches[0]:a).pageY-h;e=Math.sqrt(g*g+d*d);var l=!1;if(!c||!(67>e||93<e)){a.preventDefault();var m=setTimeout(function(){y.addClass("clockpicker-moving")},200);w&&u.append(n.canvas);n.setHand(g,d,!c,!0);q.off(z).on(z,function(a){a.preventDefault();var b=
/^touch/.test(a.type),c=(b?a.originalEvent.touches[0]:a).pageX-k;a=(b?a.originalEvent.touches[0]:a).pageY-h;if(l||c!==g||a!==d)l=!0,n.setHand(c,a,!1,!0)});q.off(A).on(A,function(a){q.off(A);a.preventDefault();var e=/^touch/.test(a.type),f=(e?a.originalEvent.changedTouches[0]:a).pageX-k;a=(e?a.originalEvent.changedTouches[0]:a).pageY-h;(c||l)&&f===g&&a===d&&n.setHand(f,a);"hours"===n.currentView?n.toggleView("minutes",B/2):b.autoclose&&(n.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){n.done()},
B/2));u.prepend(C);clearTimeout(m);y.removeClass("clockpicker-moving");q.off(z)})}}var f=l('<div class="popover clockpicker-popover"><div class="arrow"></div><div class="popover-title"><span class="clockpicker-span-hours text-primary"></span> : <span class="clockpicker-span-minutes"></span><span class="clockpicker-span-am-pm"></span></div><div class="popover-content"><div class="clockpicker-plate"><div class="clockpicker-canvas"></div><div class="clockpicker-dial clockpicker-hours"></div><div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div></div><span class="clockpicker-am-pm-block"></span></div></div>'),
u=f.find(".clockpicker-plate"),h=f.find(".clockpicker-hours"),g=f.find(".clockpicker-minutes"),m=f.find(".clockpicker-am-pm-block"),c="INPUT"===a.prop("tagName"),k=c?a:a.find("input"),d=a.find(".input-group-addon"),n=this;this.id=F("cp");this.element=a;this.options=b;this.isShown=this.isAppended=!1;this.currentView="hours";this.isInput=c;this.input=k;this.addon=d;this.popover=f;this.plate=u;this.hoursView=h;this.minutesView=g;this.amPmBlock=m;this.spanHours=f.find(".clockpicker-span-hours");this.spanMinutes=
f.find(".clockpicker-span-minutes");this.spanAmPm=f.find(".clockpicker-span-am-pm");this.amOrPm="PM";b.twelvehour&&(l('<div class="clockpicker-am-pm-block"><button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">AM</button><button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">PM</button></div>'),l('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){n.amOrPm=
"AM";l(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),l('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){n.amOrPm="PM";l(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock));b.autoclose||l('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+b.donetext+"</button>").click(l.proxy(this.done,this)).appendTo(f);"top"!==b.placement&&"bottom"!==b.placement||
"top"!==b.align&&"bottom"!==b.align||(b.align="left");"left"!==b.placement&&"right"!==b.placement||"left"!==b.align&&"right"!==b.align||(b.align="top");f.addClass(b.placement);f.addClass("clockpicker-align-"+b.align);this.spanHours.click(l.proxy(this.toggleView,this,"hours"));this.spanMinutes.click(l.proxy(this.toggleView,this,"minutes"));k.on("focus.clockpicker click.clockpicker",l.proxy(this.show,this));d.on("click.clockpicker",l.proxy(this.toggle,this));m=l('<div class="clockpicker-tick"></div>');
if(b.twelvehour)for(c=1;13>c;c+=1){k=m.clone();d=c/6*Math.PI;var v=80;k.css("font-size","120%");k.css({left:100+Math.sin(d)*v-13,top:100-Math.cos(d)*v-13});k.html(0===c?"00":c);h.append(k);k.on(x,e)}else for(c=0;24>c;c+=1){k=m.clone();d=c/6*Math.PI;var t=0<c&&13>c;v=t?54:80;k.css({left:100+Math.sin(d)*v-13,top:100-Math.cos(d)*v-13});t&&k.css("font-size","120%");k.html(0===c?"00":c);h.append(k);k.on(x,e)}for(c=0;60>c;c+=5)k=m.clone(),d=c/30*Math.PI,k.css({left:100+80*Math.sin(d)-13,top:100-80*Math.cos(d)-
13}),k.css("font-size","120%"),k.html(r(c)),g.append(k),k.on(x,e);u.on(x,function(a){0===l(a.target).closest(".clockpicker-tick").length&&e(a,!0)});if(w){var C=f.find(".clockpicker-canvas");f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("class","clockpicker-svg");f.setAttribute("width",200);f.setAttribute("height",200);h=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttribute("transform","translate(100,100)");g=document.createElementNS("http://www.w3.org/2000/svg",
"circle");g.setAttribute("class","clockpicker-canvas-bearing");g.setAttribute("cx",0);g.setAttribute("cy",0);g.setAttribute("r",2);m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",0);m.setAttribute("y1",0);c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("class","clockpicker-canvas-bg");c.setAttribute("r",13);k=document.createElementNS("http://www.w3.org/2000/svg","circle");k.setAttribute("class","clockpicker-canvas-fg");k.setAttribute("r",
3.5);h.appendChild(m);h.appendChild(c);h.appendChild(k);h.appendChild(g);f.appendChild(h);C.append(f);this.hand=m;this.bg=c;this.fg=k;this.bearing=g;this.g=h;this.canvas=C}p(this.options.init)}function p(a){a&&"function"===typeof a&&a()}var l=window.jQuery,D=l(window),q=l(document),y,w="SVGAngle"in window&&function(){var a=document.createElement("div");a.innerHTML="<svg/>";var b="http://www.w3.org/2000/svg"==(a.firstChild&&a.firstChild.namespaceURI);a.innerHTML="";return b}(),H=function(){var a=document.createElement("div").style;
return"transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a}(),t="ontouchstart"in window,x="mousedown"+(t?" touchstart":""),z="mousemove.clockpicker"+(t?" touchmove.clockpicker":""),A="mouseup.clockpicker"+(t?" touchend.clockpicker":""),E=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,G=0,B=H?350:1;d.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"\u5b8c\u6210",autoclose:!1,twelvehour:!1,vibrate:!0};
d.prototype.toggle=function(){this[this.isShown?"hide":"show"]()};d.prototype.locate=function(){var a=this.element,b=this.popover,e=a.offset(),f=a.outerWidth();a=a.outerHeight();var d=this.options.placement,h=this.options.align,g={};b.show();switch(d){case "bottom":g.top=e.top+a;break;case "right":g.left=e.left+f;break;case "top":g.top=e.top-b.outerHeight();break;case "left":g.left=e.left-b.outerWidth()}switch(h){case "left":g.left=e.left;break;case "right":g.left=e.left+f-b.outerWidth();break;case "top":g.top=
e.top;break;case "bottom":g.top=e.top+a-b.outerHeight()}b.css(g)};d.prototype.show=function(a){if(!this.isShown){p(this.options.beforeShow);var b=this;this.isAppended||(y=l(document.body).append(this.popover),D.on("resize.clockpicker"+this.id,function(){b.isShown&&b.locate()}),this.isAppended=!0);a=((this.input.prop("value")||this.options["default"]||"")+"").split(":");"now"===a[0]&&(a=new Date(+new Date+this.options.fromnow),a=[a.getHours(),a.getMinutes()]);this.hours=+a[0]||0;this.minutes=+a[1]||
0;this.spanHours.html(r(this.hours));this.spanMinutes.html(r(this.minutes));this.toggleView("hours");this.locate();this.isShown=!0;q.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(a){a=l(a.target);0===a.closest(b.popover).length&&0===a.closest(b.addon).length&&0===a.closest(b.input).length&&b.hide()});q.on("keyup.clockpicker."+this.id,function(a){27===a.keyCode&&b.hide()});p(this.options.afterShow)}};d.prototype.hide=function(){p(this.options.beforeHide);this.isShown=!1;
q.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id);q.off("keyup.clockpicker."+this.id);this.popover.hide();p(this.options.afterHide)};d.prototype.toggleView=function(a,b){var e=!1;"minutes"===a&&"visible"===l(this.hoursView).css("visibility")&&(p(this.options.beforeHourSelect),e=!0);var f="hours"===a,d=f?this.hoursView:this.minutesView,h=f?this.minutesView:this.hoursView;this.currentView=a;this.spanHours.toggleClass("text-primary",f);this.spanMinutes.toggleClass("text-primary",!f);
h.addClass("clockpicker-dial-out");d.css("visibility","visible").removeClass("clockpicker-dial-out");this.resetClock(b);clearTimeout(this.toggleViewTimer);this.toggleViewTimer=setTimeout(function(){h.css("visibility","hidden")},B);e&&p(this.options.afterHourSelect)};d.prototype.resetClock=function(a){var b=this.currentView,e=this[b],f="hours"===b;b=Math.PI/(f?6:30)*e;e=f&&0<e&&13>e?54:80;var d=Math.sin(b)*e,h=-Math.cos(b)*e,g=this;w&&a?(g.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){g.canvas.removeClass("clockpicker-canvas-out");
g.setHand(d,h)},a)):this.setHand(d,h)};d.prototype.setHand=function(a,b,e,f){var d=Math.atan2(a,-b),h="hours"===this.currentView,g=Math.PI/(h||e?6:30);b=Math.sqrt(a*a+b*b);a=this.options;var m=h&&67>b;b=m?54:80;a.twelvehour&&(b=80);0>d&&(d=2*Math.PI+d);var c=Math.round(d/g);d=c*g;a.twelvehour?h?0===c&&(c=12):(e&&(c*=5),60===c&&(c=0)):h?(12===c&&(c=0),c=m?0===c?12:c:0===c?0:c+12):(e&&(c*=5),60===c&&(c=0));this[this.currentView]!==c&&E&&this.options.vibrate&&!this.vibrateTimer&&(navigator[E](10),this.vibrateTimer=
setTimeout(l.proxy(function(){this.vibrateTimer=null},this),100));this[this.currentView]=c;this[h?"spanHours":"spanMinutes"].html(r(c));w?(f||!h&&c%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg")),e=Math.sin(d)*b,d=-Math.cos(d)*b,this.hand.setAttribute("x2",
e),this.hand.setAttribute("y2",d),this.bg.setAttribute("cx",e),this.bg.setAttribute("cy",d),this.fg.setAttribute("cx",e),this.fg.setAttribute("cy",d)):this[h?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var a=l(this);a.toggleClass("active",c===+a.html())})};d.prototype.done=function(){p(this.options.beforeDone);this.hide();var a=this.input.prop("value"),b=r(this.hours)+":"+r(this.minutes);this.options.twelvehour&&(b+=this.amOrPm);this.input.prop("value",b);b!==a&&(this.input.triggerHandler("change"),
this.isInput||this.element.trigger("change"));this.options.autoclose&&this.input.trigger("blur");p(this.options.afterDone)};d.prototype.remove=function(){this.element.removeData("clockpicker");this.input.off("focus.clockpicker click.clockpicker");this.addon.off("click.clockpicker");this.isShown&&this.hide();this.isAppended&&(D.off("resize.clockpicker"+this.id),this.popover.remove())};l.fn.clockpicker=function(a){var b=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=l(this),
f=e.data("clockpicker");f?"function"===typeof f[a]&&f[a].apply(f,b):(f=l.extend({},d.DEFAULTS,e.data(),"object"==typeof a&&a),e.data("clockpicker",new d(e,f)))})}})();